# ğŸš€ Lateral Movement via RDP & PsExec

This document demonstrates two common lateral movement techniques attackers use to expand access within a network: **Remote Desktop Protocol (RDP)** and **PsExec**.

---

ğŸ§ª Lab Setup
- **Attacker:** Kali Linux ğŸ§  
- **Victim:** Windows 11 VM ğŸ’» 
- **Monitoring:** Splunk Enterprise ğŸ“Š for log analysis



ğŸ”‘ Technique 1: RDP

- **Tool:** `xfreerdp` ğŸ–¥ï¸  
- **MITRE ATT&CK:** T1021.001 ğŸ¯  
- **Detection:** Windows Event ID 4624 with Logon Type 10 (RDP logon)  
- **Splunk Query:**  
  ```spl
  index=wineventlog EventCode=4624 Logon_Type=10


````markdown
# ğŸš€ Lateral Movement via RDP & PsExec

This document demonstrates two common lateral movement techniques attackers use to expand access within a network: **Remote Desktop Protocol (RDP)** and **PsExec**.

---

## ğŸ§ª Lab Setup
- **Attacker:** Kali Linux ğŸ§  
- **Victim:** Windows 11 VM ğŸ’»   
- **Monitoring:** Splunk Enterprise ğŸ“Š for log analysis

---

## ğŸ”‘ Technique 1: RDP

- **Tool:** `xfreerdp` ğŸ–¥ï¸  
- **MITRE ATT&CK:** T1021.001 ğŸ¯  
- **Detection:** Windows Event ID 4624 with Logon Type 10 (RDP logon)  
- **Splunk Query:**  
  ```spl
  index=wineventlog EventCode=4624 Logon_Type=10
````

* **Test Command:**

  ```bash
  xfreerdp /v:192.168.189.150 /u:user /p:Password /cert:ignore /sec:rdp
  ```

---

## ğŸ”§ Technique 2: PsExec

* **Tool:** `psexec.py` (Impacket) ğŸ”¥
* **MITRE ATT\&CK:** T1021.002 ğŸ¯
* **Detection:**

  * Event ID 4624 (Logon Type 3 or 5) âœ…
  * Event ID 7045 (Service creation) âš™ï¸
* **Splunk Queries:**

  ```spl
  index=wineventlog EventCode=4624 Logon_Type=3 OR Logon_Type=5
  ```

  ```spl
  index=wineventlog EventCode=7045
  ```
* **Test Command:**

  ```bash
  python3 /usr/share/doc/python3-impacket/examples/psexec.py Domain name/user:Password@192.168.189.150
  ```

---

## ğŸ“‹ Summary Table

| Technique | Tool      | Key Event IDs         | MITRE ID  |
| --------- | --------- | --------------------- | --------- |
| RDP       | xfreerdp  | 4624 (Logon Type 10)  | T1021.001 |
| PsExec    | psexec.py | 4624 (Type 3/5), 7045 | T1021.002 |

---

## ğŸ›¡ï¸ Recommendations

* Restrict RDP and SMB access via firewall ğŸš§
* Enable service creation logging ğŸ“
* Monitor for unusual logon types and service installs ğŸ”
* Use Splunk for real-time detection âš¡

---

## ğŸ”— References

* [MITRE ATT\&CK T1021.001](https://attack.mitre.org/techniques/T1021/001/)
* [MITRE ATT\&CK T1021.002](https://attack.mitre.org/techniques/T1021/002/)
* [Impacket GitHub](https://github.com/fortra/impacket)



ğŸ“‚ Data Required

| Source             | Event Log                          | Event ID | Purpose                           |
| ------------------ | ---------------------------------- | -------- | --------------------------------- |
| Windows Event Logs | `Security` (WinEventLog\:Security) | `4624`   | Detect successful logons          |
|                    |                                    | `4625`   | (Optional) Detect failed attempts |
| Network telemetry  | Firewall or NetFlow logs           | â€”        | (Optional) Confirm connections    |



ğŸ¯ Detection Logic

âœ… SPL (Splunk Query)

```spl
index="wineventlog" source="WinEventLog:Security" EventCode=4624 Logon_Type=10
| table _time, ComputerName, Account_Name, Ip_Address, Workstation_Name, Logon_Type
| sort - _time
```

ğŸ“Œ Key Indicators

| Field           | Description                              |
| --------------- | ---------------------------------------- |
| `Logon_Type=10` | Indicates Remote Interactive (RDP) Logon |
| `Ip_Address`    | Source IP used for the login             |
| `Account_Name`  | User account used                        |
| `ComputerName`  | Destination system of the RDP session    |
| `_time`         | Time of login                            |



ğŸ§ª Test Scenario

ğŸ”§ Setup

* Attacker: Kali Linux
* Victim: Windows 10 VM with RDP enabled
* Monitor: Splunk Enterprise collecting Windows Security logs

### ğŸ§ª Simulation Steps

1. From Kali Linux, initiate an RDP session to the target Windows VM:

   ```bash
   xfreerdp3 /v:<target_ip> /u:Dummy /p:Password12345 /cert:ignore
   ```

   *(Make sure RDP is enabled on the Windows VM and the user account has permission to log in remotely.)*

2. On the Windows VM:

   * The Security log will record **Event ID 4624** with **Logon Type 10**.

3. In Splunk:

   * Run the detection SPL to verify the logon attempt was recorded:

     ```spl
     index="wineventlog" source="WinEventLog:Security" EventCode=4624 Logon_Type=10
     ```



## ğŸ§  MITRE ATT\&CK Mapping

| Tactic           | Technique                                                                                                    |
| ---------------- | ------------------------------------------------------------------------------------------------------------ |
| Lateral Movement | [T1021.001 - Remote Services: Remote Desktop Protocol (RDP)](https://attack.mitre.org/techniques/T1021/001/) |



ğŸš© Use Case Scenarios

| Scenario                              | Expected Behavior                                      |
| ------------------------------------- | ------------------------------------------------------ |
| RDP login from unusual IP             | Alert â€” Possible unauthorized access                   |
| RDP login outside business hours      | Alert â€” Suspicious timing                              |
| Account used to log in multiple hosts | Alert â€” Lateral movement using compromised credentials |



ğŸ§¹ Mitigation Strategies

* **Disable RDP** unless absolutely required.
* Enforce **strong passwords** and **multi-factor authentication**.
* Limit RDP access via **firewall rules** or **network segmentation**.
* Enable **Network Level Authentication (NLA)**.
* Audit and alert on **Event ID 4624 with Logon Type 10**.



ğŸ“ References

* ğŸ”— [MITRE ATT\&CK T1021.001 â€“ Remote Desktop Protocol](https://attack.mitre.org/techniques/T1021/001/)
* ğŸ”— [Microsoft: Logon Event ID 4624](https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4624)
* ğŸ”— [FreeRDP GitHub](https://github.com/FreeRDP/FreeRDP)


